# پروژه رَصَد: راهنمای جامع

## فهرست مطالب

1. [معرفی پروژه](#معرفی-پروژه)
2. [معماری سیستم](#معماری-سیستم)
3. [ماژول‌های اصلی](#ماژول‌های-اصلی)
4. [وضعیت فعلی پروژه](#وضعیت-فعلی-پروژه)
5. [راهنمای نصب و راه‌اندازی](#راهنمای-نصب-و-راه‌اندازی)
6. [راهنمای توسعه](#راهنمای-توسعه)
7. [استراتژی توسعه آینده](#استراتژی-توسعه-آینده)
8. [مستندات API و سرویس‌های خارجی](#مستندات-api-و-سرویس‌های-خارجی)
9. [پرسش‌های متداول](#پرسش‌های-متداول)

## معرفی پروژه

پروژه "رَصَد" (Rasad) یک سیستم هوشمند پایش، تحلیل و گزارش‌دهی فعالیت‌های شبکه‌های اجتماعی، مشخصاً توییتر، است. این سیستم به سازمان‌ها کمک می‌کند تا:

- **موج‌های انتقادی و فعالیت‌های مشکوک** را به سرعت شناسایی کنند
- **افکار عمومی** درباره موضوعات مختلف را بهتر درک کنند
- **روندها و الگوهای کاربران** را تحلیل نمایند
- براساس **داده‌های دقیق**، استراتژی‌های ارتباطی مناسب را اتخاذ کنند

### مزایای اصلی

- **پایش خودکار کلیدواژه‌ها**: رصد مداوم کلیدواژه‌های مرتبط با سازمان
- **تشخیص موج‌های توییتری**: شناسایی افزایش ناگهانی توییت‌ها یا تغییرات احساسات
- **تحلیل عمیق با هوش مصنوعی**: استفاده از Claude API برای تحلیل احساسات و موضوعات
- **سیستم هشدار هوشمند**: اعلام خودکار موج‌های انتقادی و فعالیت‌های مشکوک
- **گزارش‌های تحلیلی**: تولید گزارش‌های دوره‌ای و تخصصی براساس داده‌ها
- **پایش فعالیت مدیران**: تحلیل بازخوردها به توییت‌های مدیر سازمان
- **مدیریت هزینه API**: بهینه‌سازی هوشمند استفاده از API‌های خارجی

### فاز‌های اصلی پروژه

پروژه رصد از سه فاز اصلی تشکیل شده است:

1. **فاز استخراج**: جمع‌آوری مداوم توییت‌ها براساس کلیدواژه‌ها و کاربران خاص
2. **فاز تحلیل**: پردازش و تحلیل عمیق محتوای توییت‌ها با استفاده از هوش مصنوعی
3. **فاز گزارش**: طراحی داشبورد و تولید گزارش‌های تحلیلی برای مدیران

## معماری سیستم

سیستم رصد با معماری ماژولار طراحی شده تا امکان توسعه مستقل هر بخش و اضافه کردن قابلیت‌های جدید به راحتی فراهم باشد:

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  جمع‌آوری        │     │  پردازش         │     │  تحلیل          │
│  TwitterAPI.io  │────▶│  فیلترسازی      │────▶│  Claude API     │
│  وب‌هوک/وبسوکت   │     │  اولویت‌بندی     │     │  تشخیص موج      │
└─────────────────┘     └─────────────────┘     └─────────────────┘
        ▲                        ▲                      │
        │                        │                      │
        └────────────────────────┼──────────────────────┘
                                 │                
                                 ▼
┌─────────────────┐     ┌─────────────────┐
│  فرانت‌اند       │◀────│  بک‌اند          │
│  داشبورد        │     │  REST API       │
│  مدیریت تنظیمات │     │  مدیریت کاربران │
└─────────────────┘     └─────────────────┘
```

### فناوری‌های اصلی

- **زبان برنامه‌نویسی**: Python 3.9+
- **API فریم‌ورک**: FastAPI
- **ORM**: SQLAlchemy
- **پایگاه داده**: PostgreSQL
- **کش/صف**: Redis
- **API‌های خارجی**:
  - TwitterAPI.io برای جمع‌آوری داده‌های توییتر
  - Claude API برای تحلیل‌های عمیق و هوشمند
- **فرانت‌اند**: HTML/CSS/JavaScript + Bootstrap (در آینده React)

## ماژول‌های اصلی

### 1. ماژول جمع‌آوری (Collector)

این ماژول وظیفه جمع‌آوری توییت‌ها براساس کلیدواژه‌ها و کاربران خاص را بر عهده دارد:

- **کلاس‌های اصلی**:
  - `TwitterAPIClient`: ارتباط با TwitterAPI.io
  - `TweetCollector`: مدیریت جمع‌آوری توییت‌ها و ذخیره‌سازی
  
- **قابلیت‌های کلیدی**:
  - جستجوی توییت براساس کلیدواژه‌ها با پشتیبانی از اپراتورهای پیشرفته
  - جمع‌آوری اطلاعات پروفایل کاربران
  - مدیریت صفحه‌بندی و حداکثر تعداد نتایج
  - ذخیره‌سازی در دیتابیس با حذف توییت‌های تکراری
  - ارسال توییت‌های جدید به صف پردازش

- **فایل‌های مرتبط**:
  - `/app/services/twitter/client.py`
  - `/app/services/twitter/collector.py`
  - `/app/services/twitter/models.py`

### 2. ماژول پردازش (Processor)

این ماژول وظیفه پردازش، فیلترینگ و اولویت‌بندی توییت‌های دریافتی را بر عهده دارد:

- **کلاس‌های اصلی**:
  - `ContentFilter`: فیلترینگ محتوا و تشخیص اسپم
  - `TweetProcessor`: پردازش توییت‌ها و محاسبه امتیاز اهمیت
  
- **قابلیت‌های کلیدی**:
  - تشخیص و فیلتر محتوای اسپم و نامرتبط
  - محاسبه امتیاز اهمیت توییت‌ها براساس تعاملات و تاثیرگذاری
  - استخراج موجودیت‌ها (هشتگ‌ها، منشن‌ها، URL‌ها)
  - تشخیص زبان متن
  - تحلیل اولیه احساسات

- **فایل‌های مرتبط**:
  - `/app/services/processor/content_filter.py`
  - `/app/services/processor/tweet_processor.py`

### 3. ماژول تحلیل (Analyzer)

این ماژول عملیات تحلیل عمیق و هوشمند توییت‌ها را با استفاده از هوش مصنوعی انجام می‌دهد:

- **کلاس‌های اصلی**:
  - `ClaudeClient`: ارتباط با Claude API
  - `CostManager`: مدیریت هزینه و بهینه‌سازی استفاده از API
  - `WaveDetector`: تشخیص موج‌های توییتری
  - `TweetAnalyzer`: تحلیل عمیق توییت‌ها
  
- **قابلیت‌های کلیدی**:
  - تحلیل دقیق احساسات متون فارسی و انگلیسی
  - شناسایی موضوعات اصلی و کلیدواژه‌ها
  - تشخیص موج‌های حجمی (افزایش ناگهانی تعداد توییت‌ها)
  - تشخیص موج‌های احساسی (تغییر قابل توجه در احساسات)
  - ایجاد هشدار برای موج‌های مهم
  - مدیریت بهینه هزینه API با سیستم چندلایه‌ای

- **فایل‌های مرتبط**:
  - `/app/services/analyzer/claude_client.py`
  - `/app/services/analyzer/cost_manager.py`
  - `/app/services/analyzer/wave_detector.py`
  - `/app/services/analyzer/analyzer.py`

### 4. ماژول بک‌اند (Backend)

این ماژول API‌ها و اندپوینت‌های لازم برای تعامل با سیستم را فراهم می‌کند:

- **کلاس‌های اصلی**:
  - روترهای FastAPI برای دسترسی به قابلیت‌های مختلف
  - میدلورهای احراز هویت و لاگینگ
  
- **قابلیت‌های کلیدی**:
  - اندپوینت‌های احراز هویت و مدیریت کاربران
  - اندپوینت‌های جستجو و مدیریت توییت‌ها
  - اندپوینت‌های تحلیل و گزارش‌گیری
  - اندپوینت‌های مدیریت هشدارها و موج‌ها
  - اندپوینت‌های مدیریت تنظیمات سیستم

- **فایل‌های مرتبط**:
  - `/app/api/v1/auth.py`
  - `/app/api/v1/tweets.py`
  - `/app/api/v1/analysis.py`
  - `/app/api/v1/waves.py`
  - `/app/api/v1/settings.py`

### 5. ماژول فرانت‌اند (Frontend)

این ماژول رابط کاربری برای تعامل با سیستم را فراهم می‌کند (در حال توسعه):

- **صفحات اصلی**:
  - داشبورد: نمایش خلاصه وضعیت و آمارها
  - توییت‌ها: جستجو و مدیریت توییت‌ها
  - هشدارها: مشاهده و مدیریت هشدارها
  - تنظیمات: مدیریت کلیدواژه‌ها و تنظیمات سیستم
  
- **قابلیت‌های کلیدی**:
  - نمایش داشبورد با آمارها و گزارش‌های مهم
  - جستجو و فیلتر توییت‌ها
  - مشاهده و مدیریت هشدارها
  - مدیریت کلیدواژه‌ها و تنظیمات API

- **فایل‌های مرتبط**:
  - `/frontend/app/index.html`
  - `/frontend/app/app.js`

## وضعیت فعلی پروژه

براساس تحلیل کدهای موجود، وضعیت پیشرفت ماژول‌های مختلف به شرح زیر است:

| ماژول | وضعیت پیشرفت | توضیحات |
|------|--------------|---------|
| زیرساخت پایه | 100% تکمیل شده | مدل‌های دیتابیس، تنظیمات، میدلورها و زیرساخت‌های اصلی |
| ماژول جمع‌آوری | 100% تکمیل شده | کلاینت TwitterAPI، جمع‌آوری توییت‌ها، استخراج پروفایل کاربران |
| ماژول پردازش | 100% تکمیل شده | فیلتر محتوا، محاسبه امتیاز اهمیت، استخراج موجودیت‌ها |
| ماژول تحلیل | 100% تکمیل شده | کلاینت Claude، تحلیل احساسات، تشخیص موج، مدیریت هزینه |
| ماژول بک‌اند | 30% تکمیل شده | ساختار API پایه و برخی اندپوینت‌ها پیاده‌سازی شده است |
| ماژول فرانت‌اند | 0% تکمیل شده | فقط نمونه‌های اولیه HTML/JS ساده موجود است |

### ویژگی‌های تکمیل شده

- ✅ **جمع‌آوری توییت براساس کلیدواژه**: پیاده‌سازی کامل جستجو و ذخیره‌سازی توییت‌ها
- ✅ **جمع‌آوری اطلاعات کاربران**: دریافت و ذخیره پروفایل‌های کاربران مرتبط
- ✅ **پردازش محتوای توییت**: استخراج متادیتا و ذخیره‌سازی ساختاریافته
- ✅ **تشخیص اسپم و محتوای نامرتبط**: فیلترینگ پایه برای بهبود کیفیت داده‌ها
- ✅ **تحلیل مرتبط بودن با کلیدواژه‌ها**: محاسبه امتیاز ارتباط
- ✅ **محاسبه امتیاز اهمیت توییت‌ها**: الگوریتم اولویت‌بندی توییت‌ها
- ✅ **تحلیل احساسات**: تشخیص احساسات مثبت/منفی/خنثی توییت‌ها با هوش مصنوعی
- ✅ **تشخیص موج‌های حجمی**: شناسایی افزایش ناگهانی حجم توییت‌ها
- ✅ **شناسایی موضوعات اصلی**: استخراج و دسته‌بندی موضوعات
- ✅ **سیستم هشدار**: ایجاد هشدار برای موج‌های مهم و تغییرات قابل توجه
- ✅ **مدیریت هزینه API**: سیستم بهینه‌سازی مصرف API با انتخاب هوشمند مدل‌ها

### ویژگی‌های در حال توسعه

- ⏳ **API‌های بک‌اند**: اندپوینت‌های دسترسی به تحلیل‌ها، توییت‌ها و هشدارها
- ⏳ **مدیریت کاربران سیستم**: احراز هویت و کنترل دسترسی
- ⏳ **داشبورد مدیریتی**: رابط کاربری برای مدیریت و مشاهده تحلیل‌ها
- ⏳ **مدیریت تنظیمات**: رابط‌های مدیریت کلیدواژه‌ها و تنظیمات سیستم

## راهنمای نصب و راه‌اندازی

### پیش‌نیازها

- Python 3.9+
- PostgreSQL
- Redis
- کلید API برای TwitterAPI.io
- کلید API برای Anthropic Claude

برای راهنمای کامل نصب و پیکربندی سیستم به [راهنمای نصب](docks/installation-guide.md) مراجعه کنید.

### راه‌اندازی سریع

```bash
# کلون کردن مخزن
git clone https://github.com/your-org/rasad.git
cd rasad

# ایجاد محیط مجازی
python -m venv venv
source venv/bin/activate  # در لینوکس/مک
# venv\Scripts\activate.bat  # در ویندوز

# نصب وابستگی‌ها
pip install -r requirements.txt

# تنظیم فایل .env
cp .env.example .env
# سپس فایل .env را با اطلاعات خود ویرایش کنید

# ایجاد دیتابیس و کاربر مدیر
python scripts/create_admin.py

# اجرای سرویس‌ها
# سرور API
uvicorn app.main:app --reload

# جمع‌آوری کننده
python scripts/run_collector.py

# پردازشگر
python scripts/run_processor.py

# تحلیلگر
python scripts/run_analyzer.py

# یا اجرای همه سرویس‌ها با هم
python scripts/run_all.py
```

## راهنمای توسعه

### ساختار پروژه

```
/app                  # کد اصلی پروژه
  /api                # اندپوینت‌های API
    /v1               # نسخه 1 API
  /core               # تابع‌های هسته‌ای
  /db                 # مدل‌ها و ارتباط با دیتابیس
  /middlewares        # میدلورهای FastAPI
  /schemas            # مدل‌های Pydantic
  /services           # سرویس‌های مختلف
    /analyzer         # سرویس‌های تحلیل
    /processor        # سرویس‌های پردازش
    /redis_service.py # سرویس Redis
    /twitter          # سرویس‌های ارتباط با توییتر
  /main.py            # نقطه ورود اصلی برنامه

/docks                # مستندات
/frontend             # فایل‌های فرانت‌اند
/scripts              # اسکریپت‌های کمکی
  /create_admin.py    # ایجاد کاربر مدیر
  /run_*.py           # اسکریپت‌های اجرای سرویس‌ها

.env.example          # نمونه فایل تنظیمات محیطی
requirements.txt      # وابستگی‌های پایتون
```

### راهنمای توسعه ماژول‌ها

برای اطلاعات دقیق در مورد توسعه هر ماژول، به مستندات اختصاصی آن مراجعه کنید:

- [راهنمای توسعه زیرساخت پایه](docks/basic-infrastructure-guide.md)
- [راهنمای توسعه ماژول جمع‌آوری](docks/collector-guide.md)
- [راهنمای توسعه ماژول پردازش](docks/processor-guide.md)
- [راهنمای توسعه ماژول تحلیل](docks/analyzer-guide.md)
- [راهنمای توسعه ماژول بک‌اند](docks/backend-guide.md)
- [راهنمای توسعه ماژول فرانت‌اند](docks/frontend-guide.md)

## استراتژی توسعه آینده

با توجه به وضعیت فعلی پروژه، استراتژی توسعه بر اساس اولویت‌های زیر تعیین شده است:

### اولویت‌های کوتاه‌مدت (1-2 ماه)

1. **تکمیل فرانت‌اند ساده**:
   - پیاده‌سازی داشبورد اصلی با امکان مشاهده وضعیت سیستم
   - ایجاد صفحه مدیریت کلیدواژه‌ها
   - پیاده‌سازی صفحه مشاهده توییت‌ها و هشدارها
   
2. **تکمیل اندپوینت‌های API ضروری**:
   - اندپوینت‌های مدیریت کلیدواژه‌ها
   - اندپوینت‌های جستجوی توییت و مشاهده هشدارها
   - اندپوینت‌های وضعیت سیستم و آمار کلی

3. **بهینه‌سازی ماژول استخراج**:
   - افزایش دقت فیلترینگ محتوای نامرتبط
   - بهبود الگوریتم تشخیص اهمیت توییت‌ها
   - پیاده‌سازی استخراج آرشیوی توییت‌ها

### اولویت‌های میان‌مدت (3-6 ماه)

1. **ارتقای سیستم تحلیل**:
   - بهبود الگوریتم‌های تشخیص موج
   - افزودن تحلیل‌های پیشرفته‌تر با استفاده از مدل‌های زبانی
   - پیاده‌سازی تشخیص ارتباطات بین کاربران

2. **توسعه سیستم گزارش‌دهی**:
   - ایجاد گزارش‌های دوره‌ای خودکار
   - افزودن نمودارها و تحلیل‌های بصری
   - پیاده‌سازی هشدارهای پیش‌بینی‌کننده

3. **بهبود رابط کاربری**:
   - طراحی مجدد با React
   - افزودن نمودارهای تعاملی
   - پیاده‌سازی داشبورد شخصی‌سازی شده

### برنامه بلندمدت (+6 ماه)

1. **گسترش منابع داده**:
   - افزودن سایر شبکه‌های اجتماعی
   - یکپارچه‌سازی با منابع خبری از طریق RSS
   - پیاده‌سازی سیستم یکپارچه تحلیل رسانه‌ای

2. **توسعه قابلیت‌های هوش مصنوعی**:
   - پیاده‌سازی مدل‌های پیش‌بینی روندها
   - تشخیص خودکار کمپین‌های هماهنگ شده
   - تحلیل عمیق‌تر سنتیمنت و مفاهیم

## مستندات API و سرویس‌های خارجی

برای اطلاعات دقیق در مورد API‌ها و سرویس‌های خارجی استفاده شده در پروژه، به مستندات زیر مراجعه کنید:

- [مستندات TwitterAPI](docks/twitter-api-optimized.md) - راهنمای استفاده از TwitterAPI.io
- [مستندات Anthropic API](docks/anthropic-api-reference.md) - راهنمای استفاده از Claude API

## پرسش‌های متداول

### چگونه می‌توانم کلیدواژه‌های جدید اضافه کنم؟

کلیدواژه‌های جدید را می‌توانید از طریق API یا رابط کاربری اضافه کنید:

```bash
# افزودن از طریق API
curl -X POST "http://localhost:8000/api/v1/tweets/keywords" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"text": "کلیدواژه_جدید", "priority": 5, "description": "توضیحات کلیدواژه"}'
```

یا از طریق رابط کاربری، به بخش تنظیمات بروید و از فرم افزودن کلیدواژه استفاده کنید.

### چگونه می‌توانم مصرف API را کنترل کنم؟

مصرف API به صورت خودکار توسط سیستم `CostManager` کنترل می‌شود. برای تنظیم بودجه روزانه، می‌توانید از API زیر استفاده کنید:

```bash
curl -X PUT "http://localhost:8000/api/v1/settings/budget?daily_budget=10.0" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

یا از طریق رابط کاربری، به بخش تنظیمات بروید و بودجه روزانه را تنظیم کنید.

### سیستم چگونه موج‌ها را تشخیص می‌دهد؟

سیستم از دو روش اصلی برای تشخیص موج استفاده می‌کند:

1. **موج‌های حجمی**: افزایش ناگهانی تعداد توییت‌ها در یک بازه زمانی
2. **موج‌های احساسی**: تغییر قابل توجه در احساسات توییت‌ها در یک بازه زمانی

پارامترهای تشخیص موج (مانند آستانه‌ها) در فایل `app/services/analyzer/wave_detector.py` تنظیم شده‌اند.

### چگونه می‌توانم سرویس‌ها را مدیریت کنم؟

برای مدیریت سرویس‌ها، از اسکریپت‌های موجود در پوشه `scripts` استفاده کنید:

```bash
# اجرای همه سرویس‌ها
python scripts/run_all.py

# اجرای فقط جمع‌آوری کننده
python scripts/run_collector.py

# اجرای فقط پردازشگر
python scripts/run_processor.py

# اجرای فقط تحلیلگر
python scripts/run_analyzer.py
```

هر سرویس را باید در یک ترمینال جداگانه اجرا کنید، مگر اینکه از `run_all.py` استفاده کنید.

---

